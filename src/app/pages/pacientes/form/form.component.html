<div class="pacientes-page">
  <form class="paciente-form">
    <!-- Header -->
    <div class="page-header">
      <div class="title">
        <h1>{{ isEdit ? 'Editar paciente' : 'Novo paciente' }}</h1>
        <p>Cadastre e mantenha os dados do paciente atualizados.</p>
      </div>
    </div>

    <div class="form-scroll">
      <div *ngIf="loading">Carregando...</div>
      <div *ngIf="error" class="p-text-danger">{{ error }}</div>

      <!-- Identificação -->
      <div class="card">
        <div class="card-title">
          <div class="icon"><i class="pi pi-user"></i></div>
          <div>
            <h2>Identificação</h2>
            <p>Dados principais do paciente</p>
          </div>
        </div>

        <div class="grid">
          <div class="form-field">
            <label for="fullName">Nome completo</label>
            <input id="fullName" type="text" pInputText [(ngModel)]="paciente.fullName" name="fullName" />
          </div>

          <div class="form-field">
            <label for="birthDate">Data de Nascimento</label>
            <p-calendar
              inputId="birthDate"
              [(ngModel)]="paciente.birthDate"
              name="birthDate"
              [showIcon]="true"
              dateFormat="dd/mm/yy"
              [style]="{ width: '100%' }"
              [inputStyle]="{ width: '100%' }"></p-calendar>
          </div>

          <div class="form-field">
            <label for="cpf">CPF</label>
            <input id="cpf" type="text" maxlength="14" pInputText [(ngModel)]="paciente.cpf" name="cpf" placeholder="Somente números" style="width: 100%;" />
          </div>
        </div>
      </div>

      <!-- Contatos -->
      <div class="card">
        <div class="card-title">
          <div class="icon"><i class="pi pi-phone"></i></div>
          <div>
            <h2>Contatos</h2>
            <p>Defina telefone, celular e/ou e-mail (marque um como principal)</p>
          </div>
        </div>

        <div class="contact-row contact-row-flex" *ngFor="let c of paciente.contacts; let i = index">
          <div>
            <p-dropdown
              [options]="contactTypes"
              [(ngModel)]="c.type"
              name="type-{{i}}"
              optionLabel="label"
              optionValue="value"
              placeholder="Tipo"
              [style]="{ width: '100%' }"></p-dropdown>
          </div>
          <div>
            <input
              type="text"
              pInputText
              [(ngModel)]="c.value"
              name="value-{{i}}"
              placeholder="Valor (telefone, e-mail...)"
              style="width: 100%;" />
          </div>
          <div class="checkbox-cell">
            <p-checkbox
              binary="true"
              [(ngModel)]="c.primary"
              name="primary-{{i}}"
              (onChange)="setPrimary(i)"
              inputId="primary-{{i}}"
              [trueValue]="true"
              [falseValue]="false"
              label="Principal"></p-checkbox>
          </div>
          <div class="actions-cell">
            <button pButton type="button" icon="pi pi-trash" class="p-button-rounded p-button-text p-button-danger" (click)="removeContact(i)"></button>
          </div>
        </div>

        <div>
          <button pButton type="button" label="Adicionar contato" icon="pi pi-plus" class="p-button-text" (click)="addContact()"></button>
        </div>
      </div>
    </div>

    <!-- Barra inferior -->
    <div class="wizard-actions" *ngIf="!loading">
      <button
        pButton
        type="button"
        label="Voltar"
        icon="pi pi-arrow-left"
        class="p-button-outlined"
        (click)="cancel()">
      </button>

      <div class="spacer"></div>

      <button
        pButton
        type="button"
        label="Novo"
        icon="pi pi-plus"
        class="p-button-outlined"
        (click)="newRecord()"
        [disabled]="saving">
      </button>

      <button
        pButton
        type="button"
        label="Salvar"
        icon="pi pi-check"
        class="p-button-primary"
        (click)="save()"
        [disabled]="saving">
      </button>
    </div>
  </form>
</div>
