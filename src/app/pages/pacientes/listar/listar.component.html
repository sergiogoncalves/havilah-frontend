<div class="pacientes-page">
  <div class="page-header">
    <div class="title">
      <h1>Pacientes</h1>
      <p>Gerencie seus pacientes e acesse rapidamente a ficha e os atendimentos.</p>
    </div>

    <div class="header-actions">
      <button
        pButton
        type="button"
        label="Novo paciente"
        icon="pi pi-plus"
        class="p-button-primary"
        (click)="navigateToNovo()">
      </button>
    </div>
  </div>

  <div class="list-card">
    <p-toolbar styleClass="toolbar">
      <ng-template pTemplate="left">
        <div class="toolbar-left">
          <span class="p-input-icon-left search">
            <i class="pi pi-search"></i>
            <input
              pInputText
              type="text"
              [(ngModel)]="globalFilter"
              placeholder="Buscar por nome, CPF, ID..."
              (input)="onGlobalFilter($event)" />
          </span>
        </div>
      </ng-template>
      <ng-template pTemplate="right">
        <button
          pButton
          type="button"
          label="Atualizar"
          icon="pi pi-refresh"
          class="p-button-outlined"
          (click)="loadPacientes()"
          [disabled]="loading">
        </button>
      </ng-template>
    </p-toolbar>

    <div *ngIf="loading" class="state">
      <p>Carregando pacientes...</p>
    </div>

    <div *ngIf="error" class="state p-text-danger">
      {{ error }}
    </div>

    <p-table
      *ngIf="!loading && !error"
      #dt
      [value]="pacientes"
      [paginator]="true"
      [rows]="10"
      [responsiveLayout]="'scroll'"
      [globalFilterFields]="['id','fullName','cpf']"
      [filterDelay]="0">
      <ng-template pTemplate="header">
        <tr>
          <th style="width: 80px;">ID</th>
          <th>Nome</th>
          <th style="width: 170px;">CPF</th>
          <th style="width: 180px;">Data de Nascimento</th>
          <th style="width: 160px;">Ações</th>
        </tr>
      </ng-template>
      <ng-template pTemplate="body" let-paciente>
        <tr>
          <td>{{ paciente.id }}</td>
          <td>
            <div class="name-cell">
              <div class="avatar" aria-hidden="true">{{ (paciente.fullName || '').slice(0, 1) || 'P' }}</div>
              <div class="name">
                <div class="full">{{ paciente.fullName }}</div>
              </div>
            </div>
          </td>
          <td>{{ formatCpf(paciente.cpf) }}</td>
          <td>{{ paciente.birthDate | date:'dd/MM/yyyy' }}</td>
          <td>
            <button
              pButton
              type="button"
              icon="pi pi-pencil"
              class="p-button-rounded p-button-text"
              title="Editar paciente"
              (click)="edit(paciente)"></button>
            <button
              pButton
              type="button"
              icon="pi pi-file-import"
              class="p-button-rounded p-button-text"
              title="Ver atendimentos do paciente"
              (click)="goToAtendimentos(paciente)"></button>
          </td>
        </tr>
      </ng-template>
      <ng-template pTemplate="emptymessage">
        <tr>
          <td colspan="5">Nenhum paciente encontrado.</td>
        </tr>
      </ng-template>
    </p-table>
  </div>
</div>
